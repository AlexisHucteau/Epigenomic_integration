---
title: "R Notebook"
output: html_notebook
---

```{r}
source("packages.R")
source("functions.R")

"%ni%" <- Negate("%in%")

load("../../DATA/CD34/Methylation/BMIQ_CD34.Rdata")
load("../../DATA/IDHm/Methylation/IDHm_BMIQ.Rdata")
```


```{r}
Blueprint <- read.csv("~/Thesis/Projects/Epigenomic_integration/BLUEPRINT_fragments_good.tsv", sep = "\t") %>%
  dplyr::select(., "gene_names":"type", "gene_type") %>%
  separate_rows(., gene_names, sep = " ") %>%
  separate_rows(., gene_type, sep = " ") %>%
  unique(.)

anno <- read.csv("~/Illumina_manifest/HumanMethylation450_15017482_v1-2.csv", skip = 7) %>% 
  dplyr::select(., "Name", "CHR", "MAPINFO", "UCSC_RefGene_Name", "UCSC_RefGene_Group", "Relation_to_UCSC_CpG_Island") %>%
  dplyr::filter(., CHR != "") %>%
  separate_rows(., UCSC_RefGene_Name, UCSC_RefGene_Group, sep = ";")

Blueprint_Granges <- GRanges(
    seqnames = Blueprint$chr,
    ranges = IRanges(start = Blueprint$start, end = Blueprint$end),
    Blueprint_gene_names = Blueprint$gene_names,
    type = Blueprint$type,
    gene_type = Blueprint$gene_type
  )
CpGs_Granges <- GRanges(
  seqnames = anno$CHR,
  ranges = IRanges(anno$MAPINFO, anno$MAPINFO +1),
  CpG = anno$Name,
  Illumina_Gene_name = anno$UCSC_RefGene_Name,
  position = anno$UCSC_RefGene_Group,
  Island = anno$Relation_to_UCSC_CpG_Island
)
overlaps_CpGs_Blueprint <- findOverlaps(Blueprint_Granges, CpGs_Granges)
match_hit_CpGs_Blueprint <- data.frame(mcols(Blueprint_Granges[queryHits(overlaps_CpGs_Blueprint),]),
                                       data.frame(mcols(CpGs_Granges[subjectHits(overlaps_CpGs_Blueprint),])))


```

```{r}
gene_list <- c("CEBPA", "CPT1A", "CPT2", "SLC25A20", "AKT1", "AKT2", "AKT3", "PPARGC1A", "PTEN")

Focus_Gene("CEBPA", BMIQ_CD34, "CD34+", match_hit_CpGs_Blueprint)
for (i in gene_list){
  Focus_Gene(i, BMIQ_CD34, "CD34+", match_hit_CpGs_Blueprint)
  Focus_Gene(i, BMIQ_IDHm, "IDHm", match_hit_CpGs_Blueprint)
}
```
```{r}
Fusionned_figures <- merge(BMIQ_CD34, BMIQ_IDHm, by.x = 0, by.y = 0)
rownames(Fusionned_figures) <- Fusionned_figures$Row.names
Fusionned_figures <- Fusionned_figures[,-1]

for (i in gene_list){
  Focus_Gene(i, Fusionned_figures, "CD34vsIDHm", match_hit_CpGs_Blueprint)
}
```

